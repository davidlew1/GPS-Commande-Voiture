<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Localisation</title>
  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyzp5OBxiya8wyAF-miJ5pzz29hzHCtcFDNDpTj77gm7DSU6UUYLO0jGFLvc3C98C_l/exec";

    async function sendLocation() {
      try {
        const position = await new Promise((resolve, reject) => {
          if (!navigator.geolocation) {
            reject(new Error("La géolocalisation n'est pas supportée par ce navigateur."));
          }
          navigator.geolocation.getCurrentPosition(resolve, reject);
        });

        const latitude = position.coords.latitude;
        const longitude = position.coords.longitude;

        // Envoi des coordonnées
        await fetch(`${scriptURL}?id=test&latitude=${latitude}&longitude=${longitude}`, {
          method: "GET"
        });

        // Récupération de l'URL
        const urlResp = await fetch(`${scriptURL}?data=url`);
        const urlText = await urlResp.text(); // ✅ C'est bien du texte

        // Récupération du message vocal
        const msgResp = await fetch(`${scriptURL}?data=message`);
        const msgText = await msgResp.text(); // ✅

        const utterance = new SpeechSynthesisUtterance(msgText);
        speechSynthesis.speak(utterance);

        setTimeout(() => {
          window.location.href = urlText.trim();
        }, 4000);

      } catch (error) {
        alert("Erreur : " + error.message);
      }
    }

    window.onload = sendLocation;
  </script>
</head>
<body>
  <h1>Envoi de la localisation...</h1>
</body>
</html>
