<!DOCTYPE html>
<html>
<head>
  <title>Localisation</title>
  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbyzp5OBxiya8wyAF-miJ5pzz29hzHCtcFDNDpTj77gm7DSU6UUYLO0jGFLvc3C98C_l/exec";

    async function sendLocation() {
      try {
        const position = await new Promise((resolve, reject) => {
          navigator.geolocation.getCurrentPosition(resolve, reject);
        });

        const latitude = position.coords.latitude;
        const longitude = position.coords.longitude;

        // Envoi GPS à Apps Script
        await fetch(`${scriptURL}?id=test&latitude=${latitude}&longitude=${longitude}`, {
          method: "POST"
        });

        // Récupération de l'URL
        const urlResp = await fetch(`${scriptURL}?data=url`);
        const urlText = await urlResp.text();

        // Récupération du message vocal
        const msgResp = await fetch(`${scriptURL}?data=message`);
        const msgText = await msgResp.text();

        // Lecture vocale
        const utterance = new SpeechSynthesisUtterance(msgText);
        speechSynthesis.speak(utterance);

        // Redirection
        window.location.href = urlText;

      } catch (error) {
        alert("Erreur : " + error.message);
      }
    }

    window.onload = sendLocation;
  </script>
</head>
<body>
  <h1>Envoi de la localisation...</h1>
</body>
</html>
